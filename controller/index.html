<!DOCTYPE html>
<html>
<head>
  <title>AMQ Hybrid Cloud Demo Controller</title>
  <meta http-equiv="content-type" content="text/html;charset=utf-8" />
<script src="node_modules/rhea/dist/rhea.js"></script>
</head>
<body>

  <h1><center>AMQ Hybrid Cloud Demo Controller</center></h1>
  <hr />
  <center><b>Current Rates</b></center>

  <center>
    <table id="rates">
    </table>
  </center>

  <hr />
  <center><b>Load Control</b></center>

  <center>
    <table border="1">
      <tr><th>Capacity</th><th>Outstanding</th><th>Rate</th><th colspan="2">Controls</th></tr>
      <tr><td id="cap">0</td><td id="outst">0</td><td id="rate">0</td>
        <td><button type="button" onclick="up_ten()">Up 10</button></td>
        <td><button type="button" onclick="down_ten()">Down 10</button></td>
      </tr>
    </table>
  </center>    

  <script>
function update_stats(data) {
    var rateTable = document.getElementById("rates");

    rows = rateTable.rows
    cells = rows[0].cells
    cells[0].innerHTML = data
}

function update_report(data) {
    var cap = document.getElementById("cap");
    var out = document.getElementById("outst");
    var rate = document.getElementById("rate");

    cap.innerHTML = data.capacity;
    out.innerHTML = data.outstanding;
    rate.innerHTML = data.rate;
}

function up_ten() {
    body = {"opcode": "INC_CAPACITY", "value": 10};
    control_tx.send({body:body});
}

function down_ten() {
    body = {"opcode": "DEC_CAPACITY", "value": 10};
    control_tx.send({body:body});
}

var client = require("rhea");
client.on("message", function (context) {
    if (context.receiver == stat_rx)
        update_stats(context.message.body);
    if (context.receiver == report_rx)
        update_report(context.message.body);
});

rateTable = document.getElementById("rates")
row = rateTable.insertRow()
row.insertCell().innerHTML = "No Traffic"


var server = "ws://127.0.0.1:8080";
var ws = client.websocket_connect(WebSocket);
var connection = client.connect({connection_details:ws(server, ["binary"]), reconnect:true});
var stat_rx = connection.open_receiver("multicast.amq-demo-stats");
var report_rx = connection.open_receiver("multicast.amq-demo-report");
var control_tx = connection.open_sender("amq-demo-control");
 
  </script>
</body>
</html>
